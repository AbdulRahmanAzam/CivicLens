# Server Configuration
NODE_ENV=development




































































































































































































































































































































































































- **WhatsApp**: Test with +92 318 3610230- **Issues**: Create GitHub issue- **Documentation**: See `/backend/LLM_GUIDE.md`## Support6. ‚úÖ Verify RAG responses quality5. ‚úÖ Test hierarchy endpoints4. ‚úÖ Monitor GROQ API usage3. ‚úÖ Test WhatsApp bot with voice messages2. ‚ö†Ô∏è Configure TTS API (optional)1. ‚úÖ Install Whisper.cpp for real STT## 7. Next Steps- **MongoDB**: ~100 MB for 1000 complaints- **GROQ API**: Free tier = 30 requests/min- **Whisper.cpp**: 200-500 MB RAM, ~30% CPU during processing### Resource Usage| Hierarchy API | GET UCs | <200ms || Hierarchy API | GET towns | <100ms || RAG | Complex query | 1-2s || RAG | Simple query | 500-1000ms || TTS | 100 chars | 200-500ms || STT (Simulation) | Any audio | <100ms || STT (Whisper) | 10s audio | 1-3s ||---------|-----------|------|| Service | Operation | Time |### Expected Response Times## 6. Performance Benchmarks```Login via frontend or use API token.Solution: Hierarchy endpoints require authentication.```**Problem**: 401 Unauthorized```node scripts/seed-complete-hierarchy.js# If empty, seed database> db.ucs.countDocuments()> db.towns.countDocuments()mongosh civiclens# Solution: Check MongoDB is running and populated```powershell**Problem**: 500 error on /hierarchy/towns or /hierarchy/ucs### Hierarchy API Errors```ls backend/src/data/knowledgeBase.json# Solution: Ensure file exists```powershell**Problem**: "Cannot find knowledge base"```// RAG already implements caching via knowledge base// Solution: Cache responses or use fallback```javascript**Problem**: "GROQ rate limit exceeded"### RAG Issues```Solution: TTS is optional. Add TTS_PROVIDER and TTS_API_KEY to .env```**Problem**: "TTS not configured"### TTS Issues```$env:SPEECH_SIMULATION_MODE = "true"# Or.\scripts\setup-whisper.ps1# Solution: Run setup script or set simulation mode```powershell**Problem**: "Whisper.cpp not found"```npm install ffprobe-static# Solution: Install ffprobe-static```powershell**Problem**: "Cannot find ffprobe"### STT Issues## 5. Troubleshooting```  -d '{"longitude": 67.0099, "latitude": 24.8607}'  -H "Content-Type: application/json" \curl -X POST http://localhost:3000/api/v1/hierarchy/find-uc \# Find UC by locationcurl http://localhost:3000/api/v1/hierarchy/cities# Get all citiescurl http://localhost:3000/api/v1/hierarchy/ucs# Get all UCscurl http://localhost:3000/api/v1/hierarchy/towns# Get all towns```powershell### Test Hierarchy API Endpoints   ```   grep "Transcription" logs/combined.log   # See STT processing   grep "RAG query" logs/combined.log   # See RAG queries   ```powershell3. **Check logs**:   - "help" ‚Üí Quick answer   - "status" ‚Üí Show complaints   - "There is a pothole" ‚Üí Complaint flow   - "Who is the mayor?" ‚Üí RAG response   - "What is CivicLens?" ‚Üí RAG response2. **Send test messages**:   ```   npm run dev   ```powershell1. **Start WhatsApp bot**:### Test WhatsApp Bot with RAG## 4. Integration Testing- **Helplines**: Emergency numbers- **Commands**: WhatsApp bot commands- **FAQ**: Common questions and answers- **Categories**: Complaint types with SLA hours- **Karachi Data**: Mayor, towns, UCs, departments- **System Info**: CivicLens features, contact, websiteContains:Located at: `backend/src/data/knowledgeBase.json`### Knowledge Base Structure```*/]  ...  },    slaHours: 72    keywords: ['pothole', 'road damage', ...],    description: 'Road conditions, potholes...',    name: 'Roads',  {[/*console.log(categories);const categories = ragService.getCategoryContext();// 5. Get category context (for classification)*/development projects, and municipal services."He is from the Pakistan Peoples Party (PPP) and oversees city-wide administration,"The mayor of Karachi is Barrister Murtaza Wahab, who has been serving since 2021./*console.log(response);const response = await ragService.generateResponse('Who is the mayor of Karachi?');// 4. Generate full RAG response*/...‚Ä¢ status / mycomplaints / history: View your recent complaints‚Ä¢ hi / hello / start: Start a new complaint submissionAvailable commands:üÜò *CivicLens Help*/*console.log(help);const help = ragService.getQuickAnswer('help');// 3. Get quick answers*/]  }    content: '{"city":{"name":"Karachi","mayor":{"name":"Barrister Murtaza Wahab"...}}}'    type: 'karachi',  {[/*console.log(results);const results = ragService.searchKnowledgeBase('mayor of Karachi');// 2. Search knowledge baseconsole.log(isComplaint); // falseconst isComplaint = await ragService.isInformationalQuery('There is garbage on my street');console.log(isInfo); // trueconst isInfo = await ragService.isInformationalQuery('What is CivicLens?');// 1. Detect if query is informationalconst ragService = require('./src/services/ragService');```javascript### Test RAGGet free key at: https://console.groq.com```RAG_ENABLED=trueGROQ_MODEL=llama-3.3-70b-versatileGROQ_API_KEY=your_groq_api_key```envRAG requires **GROQ API key** (free):### Prerequisites## 3. RAG (Retrieval-Augmented Generation) Testing```console.log(shouldUse); // true (< 500 chars, < 5 bullet points)const shouldUse = ttsService.shouldUseTTS('Short message');// Check if text should use TTSconsole.log(formatted); // "Complaint submitted! ID: CL-123"const formatted = ttsService.formatForTTS('‚úÖ *Complaint* submitted! üé´ ID: CL-123');// Text formatting for TTSconsole.log(lang); // 'hi'const lang = await ttsService.detectLanguage('‡§Ø‡§π ‡§è‡§ï ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§£ ‡§π‡•à');// Language detection*/}  duration: 2.5  audioPath: './temp/tts/audio_1234567890.mp3',  success: true,{With API configured:}  text: 'Hello! Your complaint has been received.'  message: 'TTS not configured. Sending text response instead.',  success: false,{Without API configured:/*console.log(result);const result = await ttsService.textToSpeech('Hello! Your complaint has been received.', 'en');// Convert text to speechconst ttsService = require('./src/services/ttsService');```javascript### Test TTS```TTS_API_KEY=your_openai_keyTTS_PROVIDER=openai-tts```env#### Option 4: OpenAI TTS```TTS_API_KEY=your_elevenlabs_keyTTS_PROVIDER=elevenlabs```env#### Option 3: ElevenLabs```TTS_REGION=eastusTTS_API_KEY=your_azure_speech_keyTTS_PROVIDER=azure-tts```env#### Option 2: Microsoft Azure TTS```TTS_API_KEY=your_google_cloud_tts_keyTTS_PROVIDER=google-tts```env#### Option 1: Google Cloud TTS### Supported TTS ProvidersTTS is **scaffolded but not configured**. You need to add a TTS API key to enable it.### Current Status## 2. Text-to-Speech (TTS) Testing- **Max File Size**: 25 MB- **Max Duration**: 30 seconds (configurable)- **Output**: Automatically converted to WAV for processing- **Input**: MP3, WAV, OGG, OPUS, WEBM, M4A, AAC### Supported Audio Formats```*/}  simulation: false  model: 'whisper.cpp',  processingTime: 1245,  duration: 3.2,  language: 'en',  confidence: 0.89,  transcript: "There is a large pothole on Main Street",  success: true,{/*console.log(result);});  language: 'auto',  mimeType: 'audio/wav',const result = await speechService.transcribeAudio(audioBuffer, {const audioBuffer = fs.readFileSync('./test_audio.wav');const fs = require('fs');// Transcribe audio*/}  maxFileSize: 25  maxDuration: 30,  ],    { code: 'auto', name: 'Auto-detect' }    { code: 'ur', name: 'Urdu' },    { code: 'hi', name: 'Hindi' },    { code: 'en', name: 'English' },  supportedLanguages: [  model: './models/ggml-small.bin',  mode: 'whisper' or 'simulation',  available: true,{/*console.log(status);const status = await speechService.getServiceStatus();// Check statusconst speechService = require('./src/services/speechService');```javascript### Test STT   ```   SPEECH_SIMULATION_MODE=false   WHISPER_MODEL_PATH=./models/ggml-small.bin   WHISPER_BIN_PATH=./whisper/main.exe   ```env3. **Update .env**:   - Place at: `./models/ggml-small.bin`   - Download model: https://huggingface.co/ggerganov/whisper.cpp/resolve/main/ggml-small.bin   - Place binary at: `./whisper/main` (Windows: `main.exe`)   - Download from: https://github.com/ggerganov/whisper.cpp2. **Or Manual Installation**:   ```   .\setup-whisper.ps1   cd scripts   ```powershell1. **Download Whisper.cpp**:### Installation (For Real STT)- **Simulation Mode**: For testing without Whisper.cpp installed- **Whisper.cpp Mode** (Recommended): Offline, free, high-qualityThe STT service supports two modes:### Status Check## 1. Speech-to-Text (STT) Testing```.\test_services.ps1# Or use PowerShell scriptnode test_speech_services.js# Run all testsnpm install# Install dependencies```powershell## Quick StartThis guide explains how to test the Speech-to-Text (STT), Text-to-Speech (TTS), and RAG (Retrieval-Augmented Generation) services in CivicLens.PORT=3000

# MongoDB Configuration
MONGODB_URI=mongodb://localhost:27017/civiclens

# CORS Configuration
CORS_ORIGIN=http://localhost:3001

# Cloudinary Configuration
CLOUDINARY_CLOUD_NAME=your_cloud_name
CLOUDINARY_API_KEY=your_api_key
CLOUDINARY_API_SECRET=your_api_secret

# Google Maps API (for reverse geocoding)
GOOGLE_MAPS_API_KEY=your_google_maps_key

# JWT Configuration (for future auth)
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRES_IN=7d

# SMTP Email (for invitations/password reset)
SMTP_HOST=smtp.yourprovider.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=your_smtp_username
SMTP_PASS=your_smtp_password
EMAIL_FROM="CivicLens <no-reply@yourdomain.com>"

# GROQ API Configuration (FREE - get key at console.groq.com)
GROQ_API_KEY=your_groq_api_key
GROQ_MODEL=llama-3.3-70b-versatile

# AI Classification Settings
AI_CLASSIFICATION_ENABLED=true
AI_FALLBACK_TO_LOCAL=true

# Speech Recognition (Whisper.cpp - FREE, offline)
# Download whisper.cpp from: https://github.com/ggerganov/whisper.cpp
# Download model from: https://huggingface.co/ggerganov/whisper.cpp
WHISPER_BIN_PATH=./whisper/main
WHISPER_MODEL_PATH=./models/ggml-small.bin
SPEECH_MAX_DURATION=30
SPEECH_SIMULATION_MODE=true

# Text-to-Speech Configuration (Optional, requires external API)
# Options: google-tts, azure-tts, elevenlabs, openai-tts
TTS_PROVIDER=none
TTS_API_KEY=your_tts_api_key

# RAG (Retrieval-Augmented Generation) Configuration
RAG_ENABLED=true
RAG_MAX_CONTEXT_TOKENS=4000

# WhatsApp Integration (Baileys - FREE)
# No API key needed - connects via QR code
WHATSAPP_AUTH_DIR=./whatsapp-auth
WHATSAPP_ENABLED=true

# WhatsApp Location Sharing Configuration
ENABLE_LOCATION_WEB_LINK=true
